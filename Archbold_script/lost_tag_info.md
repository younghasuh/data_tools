Tracking specific tags
================
Young Ha Suh
10/19/2020

### Load libraries

``` r
library(tidyverse)
library(knitr)
library(lubridate)
```

<br>

### Load data

Load tag data and set variables correctly.

Tag data is generated by downloaded relevant files from the CTT account
page (<https://account.celltracktech.com/>) and running it through
`data_manager.py` in Python to have a merged data set. This process will
become available in R soon.

``` r
oct19 <- read.csv("../data_tools/datafiles/station_beep_merged_oct19.csv" )
oct19$time <- as.POSIXct(oct19$Time ,format="%m/%d/%Y %H:%M", tz = "UTC")
oct19$time_est <- with_tz(oct19$time, "EST") #change from UTC to EST

# Filter to time points after Oct 17, which is the start of data I downloaded
oct <- oct19 %>% 
  filter(time_est > '2020-10-17 00:00:00')
```

| Variable  | Description                                                                                   |
| --------- | --------------------------------------------------------------------------------------------- |
| Time      | Date-time object for each beep detected; in UTC                                               |
| RadioId   | Which channel the beep was detected in (refers to each antenna on watertower), ignore for now |
| TagId     | Tag ID of beep                                                                                |
| TagRSSI   | Signal strength of beep; higher values are better                                             |
| NodeId    | Which node the beep got picked up by                                                          |
| Validated | Not sure what this is, ignore for now lol                                                     |
| time      | Time converted to POSIXct object, in UTC                                                      |
| time\_est | Time converted to POSIXct object, in EST                                                      |

<br>

Load node info

``` r
node_list <- read.csv("nodes.csv")
```

| Variable | Description                                            |
| -------- | ------------------------------------------------------ |
| NodeId   | Letter code of the node                                |
| id       | Numerical ID of node, refer to combined node map below |
| lat      | Latitude of node                                       |
| lng      | Longitude of node                                      |

<br>

![Combined node map](nodemap.png)

<br>

### Data wrangling

Use tidyverse to manipulate data.

``` r
# Need to convert to upper case to left join with the node data
oct$NodeId <- toupper(oct$NodeId)
#table(oct$NodeId) # check if it worked

# Add node numerical ID
oct <- oct %>% 
  left_join(node_list, by = "NodeId")
```

<br>

### Look for rows containing specific tag IDs

Change accordingly

``` r
# Check list of tags detected
# table(oct$TagId)

# set tags
tag1 <- "61342D4C" # -QGA
tag2 <- "342A3478" # -BBX
```

Look for these specific ones

  - Tag 1

<!-- end list -->

``` r
tag1data <- oct %>% 
  filter(TagId == tag1) %>% 
  group_by(NodeId) %>% 
  mutate(timeofday = strftime(time_est, format="%H:%M:%S", tz="EST")) %>% 
  arrange(NodeId, timeofday, -TagRSSI) %>% 
  #filter(TagRSSI > -110) %>%    set if there are too many rows
  select(NodeId, id, TagRSSI, time_est, timeofday, Validated)

oct %>% 
  filter(TagId == tag1) %>% 
  group_by(NodeId) %>% 
  mutate(timeofday = strftime(time_est, format="%H:%M:%S", tz="EST")) %>% 
  arrange(NodeId, timeofday, -TagRSSI) %>% 
  select(NodeId, id, TagRSSI, time_est, timeofday, Validated) %>% 
  kable()
```

| NodeId | id | TagRSSI | time\_est           | timeofday | Validated |
| :----- | -: | ------: | :------------------ | :-------- | --------: |
| 425    | 17 |   \-114 | 2020-10-17 09:47:00 | 09:47:00  |         0 |
| 425    | 17 |   \-114 | 2020-10-17 09:47:00 | 09:47:00  |         0 |
| 425    | 17 |   \-114 | 2020-10-17 09:47:00 | 09:47:00  |         0 |
| 425    | 17 |   \-114 | 2020-10-17 09:47:00 | 09:47:00  |         0 |
| 425    | 17 |   \-114 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| 425    | 17 |   \-114 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| 425    | 17 |   \-115 | 2020-10-17 10:11:00 | 10:11:00  |         0 |
| 425    | 17 |   \-115 | 2020-10-17 10:11:00 | 10:11:00  |         0 |
| 425    | 17 |   \-117 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| 425    | 17 |   \-117 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| 425    | 17 |   \-115 | 2020-10-17 10:35:00 | 10:35:00  |         0 |
| 425    | 17 |   \-115 | 2020-10-17 11:05:00 | 11:05:00  |         0 |
| 425    | 17 |   \-115 | 2020-10-17 13:56:00 | 13:56:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 09:36:00 | 09:36:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 09:36:00 | 09:36:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 09:37:00 | 09:37:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 09:37:00 | 09:37:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 09:39:00 | 09:39:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 09:42:00 | 09:42:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 09:46:00 | 09:46:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 09:47:00 | 09:47:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 09:50:00 | 09:50:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 09:50:00 | 09:50:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 09:50:00 | 09:50:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 09:50:00 | 09:50:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 09:52:00 | 09:52:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 09:52:00 | 09:52:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 09:54:00 | 09:54:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 09:54:00 | 09:54:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 09:55:00 | 09:55:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:01:00 | 10:01:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:01:00 | 10:01:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:01:00 | 10:01:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:01:00 | 10:01:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:03:00 | 10:03:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:04:00 | 10:04:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:07:00 | 10:07:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:07:00 | 10:07:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:09:00 | 10:09:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:10:00 | 10:10:00  |         0 |
| C3     | 10 |   \-111 | 2020-10-17 10:10:00 | 10:10:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:12:00 | 10:12:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:12:00 | 10:12:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:15:00 | 10:15:00  |         0 |
| C3     | 10 |   \-114 | 2020-10-17 10:16:00 | 10:16:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:17:00 | 10:17:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 10:20:00 | 10:20:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 10:20:00 | 10:20:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:20:00 | 10:20:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:20:00 | 10:20:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:21:00 | 10:21:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:21:00 | 10:21:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:23:00 | 10:23:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:24:00 | 10:24:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:26:00 | 10:26:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 10:26:00 | 10:26:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:30:00 | 10:30:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:30:00 | 10:30:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:31:00 | 10:31:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:31:00 | 10:31:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 10:33:00 | 10:33:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 10:33:00 | 10:33:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:35:00 | 10:35:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:37:00 | 10:37:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 10:37:00 | 10:37:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:38:00 | 10:38:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:39:00 | 10:39:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 10:42:00 | 10:42:00  |         0 |
| C3     | 10 |   \-114 | 2020-10-17 10:42:00 | 10:42:00  |         0 |
| C3     | 10 |   \-114 | 2020-10-17 10:42:00 | 10:42:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:44:00 | 10:44:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:44:00 | 10:44:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:45:00 | 10:45:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 10:45:00 | 10:45:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 10:57:00 | 10:57:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 11:00:00 | 11:00:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 11:02:00 | 11:02:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 11:02:00 | 11:02:00  |         0 |
| C3     | 10 |   \-109 | 2020-10-17 11:03:00 | 11:03:00  |         0 |
| C3     | 10 |   \-113 | 2020-10-17 11:03:00 | 11:03:00  |         0 |
| C3     | 10 |   \-113 | 2020-10-17 11:03:00 | 11:03:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:04:00 | 11:04:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:04:00 | 11:04:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 11:05:00 | 11:05:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 11:05:00 | 11:05:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 11:24:00 | 11:24:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:25:00 | 11:25:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:25:00 | 11:25:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:26:00 | 11:26:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 11:26:00 | 11:26:00  |         0 |
| C3     | 10 |   \-110 | 2020-10-17 11:36:00 | 11:36:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 11:37:00 | 11:37:00  |         0 |
| C3     | 10 |   \-105 | 2020-10-17 11:50:00 | 11:50:00  |         0 |
| C3     | 10 |   \-107 | 2020-10-17 12:44:00 | 12:44:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 12:45:00 | 12:45:00  |         0 |
| C3     | 10 |   \-108 | 2020-10-17 13:11:00 | 13:11:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 13:12:00 | 13:12:00  |         0 |
| C3     | 10 |   \-106 | 2020-10-17 13:12:00 | 13:12:00  |         0 |

``` r
View(tag1data)
```

<br>

  - Tag 2

<!-- end list -->

``` r
tag2data <- oct %>% 
  filter(TagId == tag2) %>% 
  group_by(NodeId) %>% 
  mutate(timeofday = strftime(time_est, format="%H:%M:%S", tz="EST")) %>% 
  arrange(NodeId, timeofday, -TagRSSI) %>% 
  select(NodeId, id, TagRSSI, time_est, timeofday)

oct %>% 
  filter(TagId == tag2) %>% 
  group_by(NodeId) %>% 
  mutate(timeofday = strftime(time_est, format="%H:%M:%S", tz="EST")) %>% 
  arrange(NodeId, timeofday, -TagRSSI) %>% 
  select(NodeId, id, TagRSSI, time_est, timeofday, Validated) %>% 
  kable()
```

| NodeId |  id | TagRSSI | time\_est           | timeofday | Validated |
| :----- | --: | ------: | :------------------ | :-------- | --------: |
| 326250 | 142 |   \-106 | 2020-10-18 07:32:00 | 07:32:00  |         1 |
| 326250 | 142 |   \-103 | 2020-10-18 07:33:00 | 07:33:00  |         1 |
| 326250 | 142 |   \-106 | 2020-10-18 07:36:00 | 07:36:00  |         1 |
| 32855D | 141 |   \-103 | 2020-10-18 06:57:00 | 06:57:00  |         1 |
| 32855D | 141 |   \-108 | 2020-10-17 07:17:00 | 07:17:00  |         0 |
| 32855D | 141 |   \-109 | 2020-10-17 07:21:00 | 07:21:00  |         0 |
| 32855D | 141 |   \-101 | 2020-10-18 07:28:00 | 07:28:00  |         1 |
| 32855D | 141 |    \-96 | 2020-10-18 07:29:00 | 07:29:00  |         1 |
| 32855D | 141 |   \-105 | 2020-10-17 16:41:00 | 16:41:00  |         1 |
| 32855D | 141 |    \-99 | 2020-10-17 16:44:00 | 16:44:00  |         1 |
| 32855D | 141 |   \-106 | 2020-10-17 16:47:00 | 16:47:00  |         1 |
| 32855D | 141 |   \-102 | 2020-10-17 16:48:00 | 16:48:00  |         1 |

``` r
View(tag2data)
```
